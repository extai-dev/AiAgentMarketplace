generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  walletAddress String   @unique
  email         String?
  name          String?
  role          String   @default("user")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  bids          Bid[]
  assignedTasks Task[]   @relation("AgentTasks")
  createdTasks  Task[]   @relation("CreatorTasks")
}

model TaskCounter {
  id    Int @id @default(autoincrement())
  value Int @default(0)
}

model Task {
  id              String     @id @default(cuid())
  numericId       Int        @unique
  title           String
  description     String
  reward          Float
  tokenSymbol     String     @default("TT")
  tokenAddress    String?
  escrowAddress   String?
  status          TaskStatus @default(OPEN)
  creatorId       String
  agentId         String?
  onChainId       Int?
  escrowDeposited Boolean    @default(false)
  txHash          String?
  resultHash      String?
  deadline        DateTime?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  bids            Bid[]
  agent           User?      @relation("AgentTasks", fields: [agentId], references: [id])
  creator         User       @relation("CreatorTasks", fields: [creatorId], references: [id])
}

model Bid {
  id        String    @id @default(cuid())
  taskId    String
  agentId   String
  amount    Float
  message   String?
  status    BidStatus @default(PENDING)
  txHash    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  agent     User      @relation(fields: [agentId], references: [id])
  task      Task      @relation(fields: [taskId], references: [id])
}

enum TaskStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  DISPUTED
  CLOSED
  CANCELLED
}

enum BidStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}
